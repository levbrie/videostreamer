<h1>Listing Videos</h1>
<%= link_to "Upload Video", new_video_path %>
<ul>
  <% @videos.each do |video| %>
    <% original = video.panda_video %>
    <% encoding = original.encodings['h264'] %>
    <li>
      <h5><%= video.title %></h5>
      <%= link_to "S3 Url: #{encoding.url}", encoding.url %>
      <p>Here's the raw video information</p>
      <section>
        <h4>Video Input: </h4>
        <pre><%= h original.inspect %></pre>
      </section>

      <section>
        <h4>Video Output H264:</h4>
        <pre><%= h encoding.inspect %></pre>
      </section>
      <% if encoding.success? %>

        <h3>HTML5 Player</h3>

        <!-- HTML5 player -->
        <video id="movie" width="<%= encoding.width %>" height="<%= encoding.height %>" preload="none"
          poster="<%= encoding.screenshots.first %>" controls>
          <source src="<%= encoding.url %>" type="video/mp4">
        </video>

        <h3>Thumbnails</h3>

        <ul class="thumbnails">
        <% encoding.screenshots.each do |src| %>
          <li class="span3">
            <a class="thumbnail" href="#">
              <img src="<%= src %>"
                   style="width: <%= encoding.width %>; height: <%= encoding.height %>">
            </a>
          </li>
        <% end %>
        </ul>

      <% else %>

        <div class='progress progress-striped progress-success'>
          <span id="progress-bar" class='bar' style="width: <%= encoding.encoding_progress.to_i %>%"><%= encoding.encoding_progress %> %</span>
        </div>

        The video is still processing, refresh the page in a few seconds.
      <% end %>
    </li>
  <% end %>
</ul>


